var ContainerModel=Backbone.Model.extend({}),UserModel=Backbone.Model.extend({}),UserCollection=Backbone.Collection.extend({model:UserModel}),ChatModel=Backbone.Model.extend({}),ChatCollection=Backbone.Collection.extend({model:ChatModel}),ChatroomModel=Backbone.Model.extend({defaults:{onlineUsers:new UserCollection,userChats:new ChatCollection([new ChatModel({sender:"Butters",message:"awwwwww hamburgers. ||):||",timestamp:_.now()})])},addUser:function(e){this.get("onlineUsers").add(new UserModel({username:e})),console.log("--adding-user---")},removeUser:function(e){var t=this.get("onlineUsers"),n=t.find(function(t){return t.get("username")==e});n&&t.remove(n)},addChat:function(e){var t=_.now();this.get("userChats").add(new ChatModel({sender:e.sender,message:e.message,timestamp:t}))}}),LoginModel=Backbone.Model.extend({defaults:{error:""}}),ContainerView=Backbone.View.extend({el:"#view-container",initialize:function(e){this.model.on("change:viewState",this.render,this)},render:function(){var e=this.model.get("viewState");this.$el.html(e.render().el)}}),LoginView=Backbone.View.extend({template:_.template($("#login-template").html()),events:{"click #nameBtn":"onLogin","keypress #nameText":"onHitEnter"},initialize:function(e){this.vent=e.vent,this.listenTo(this.model,"change:error",this.render,this)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},onLogin:function(){this.vent.trigger("login",this.$("#nameText").val())},onHitEnter:function(e){return 13==e.keyCode?(this.onLogin(),!1):void 0}}),ChatroomView=Backbone.View.extend({template:_.template($("#chatroom-template").html()),events:{"keypress .message-input":"messageInputPressed"},initialize:function(e){console.log(e),this.vent=e.vent;var t=this.model.get("onlineUsers"),n=this.model.get("userChats");this.listenTo(t,"add",this.renderUser,this),this.listenTo(t,"remove",this.renderUsers,this),this.listenTo(t,"reset",this.renderUsers,this),this.listenTo(n,"add",this.renderChat,this),this.listenTo(n,"remove",this.renderChats,this),this.listenTo(n,"reset",this.renderChats,this)},render:function(){this.model.get("onlineUsers");return this.$el.html(this.template()),this.renderUsers(),this.renderChats(),this},renderUsers:function(){this.$(".online-users").empty(),this.model.get("onlineUsers").each(function(e){this.renderUser(e)},this)},renderUser:function(e){var t=_.template($("#online-users-list-template").html());this.$(".online-users").append(t(e.toJSON()))},renderChats:function(){this.$(".chatbox-content").empty(),this.model.get("userChats").each(function(e){this.renderChat(e)},this)},renderChat:function(e){var t=_.template($("#chatbox-message-template").html()),n=$(t(e.toJSON()));n.appendTo(this.$(".chatbox-content")).hide().fadeIn().slideDown()},messageInputPressed:function(e){return 13===e.keyCode&&$.trim($(".message-input").val()).length>0?(this.vent.trigger("chat",this.$(".message-input").val()),this.$(".message-input").val(""),!1):(this.vent.trigger("typing"),void console.log("wut"))}}),ChatClient=function(e){var t,n=this,o=400,i=!1;n.vent=e.vent,n.hostname="http://"+window.location.host,n.connect=function(){n.socket=io.connect(n.hostname),n.setResponseListeners(n.socket)},n.login=function(e){n.socket.emit("login",e)},n.chat=function(e){n.socket.emit("chat",e)},n.addChatTyping=function(e){var t=e.username+" is typing";$(".typetypetype").text(t)},n.removeChatTyping=function(){$(".typetypetype").empty()},n.updateTyping=function(){n.socket&&(i||(i=!0,n.socket.emit("typing")),t=(new Date).getTime(),setTimeout(function(){var e=(new Date).getTime(),s=e-t;s>=o&&i&&(n.socket.emit("stop typing"),i=!1)},o))},n.setResponseListeners=function(e){e.on("welcome",function(t){e.emit("onlineUsers"),console.log("onlineUsers1: ",t),n.vent.trigger("loginDone",t)}),e.on("loginNameExists",function(e){console.log("loginNameExists: ",e),n.vent.trigger("loginNameExists",e)}),e.on("loginNameBad",function(e){console.log("loginNameBad: ",e),n.vent.trigger("loginNameBad",e)}),e.on("onlineUsers",function(e){n.vent.trigger("usersInfo",e)}),e.on("userJoined",function(e){console.log("userJoined: ",e),n.vent.trigger("userJoined",e)}),e.on("userLeft",function(e){console.log("userLeft: ",e),n.vent.trigger("userLeft",e)}),e.on("chat",function(e){console.log("chat: ",e),n.vent.trigger("chatReceived",e)}),e.on("typing",function(e){n.addChatTyping(e)}),e.on("stop typing",function(){n.removeChatTyping()})}};$(document).ready(function(){var e=new MainController;e.init()});var MainController=function(){var e=this;e.appEventBus=_.extend({},Backbone.Events),e.viewEventBus=_.extend({},Backbone.Events),e.init=function(){e.chatClient=new ChatClient({vent:e.appEventBus}),e.chatClient.connect(),e.loginModel=new LoginModel,e.containerModel=new ContainerModel({viewState:new LoginView({vent:e.viewEventBus,model:e.loginModel})}),e.containerView=new ContainerView({model:e.containerModel}),e.containerView.render()},e.viewEventBus.on("login",function(t){e.chatClient.login(t)}),e.viewEventBus.on("chat",function(t){e.chatClient.chat(t)}),e.viewEventBus.on("typing",function(){e.chatClient.updateTyping()}),e.appEventBus.on("loginDone",function(){e.chatroomModel=new ChatroomModel,e.chatroomView=new ChatroomView({vent:e.viewEventBus,model:e.chatroomModel}),e.containerModel.set("viewState",e.chatroomView),autosize($("textarea.message-input")),$(".chatbox-content")[0].scrollTop=$(".chatbox-content")[0].scrollHeight}),e.appEventBus.on("loginNameBad",function(t){e.loginModel.set("error","Invalid Name")}),e.appEventBus.on("loginNameExists",function(t){e.loginModel.set("error","Name already exists")}),e.appEventBus.on("usersInfo",function(t){var n=e.chatroomModel.get("onlineUsers"),o=_.map(t,function(e){return new UserModel({username:e})});n.reset(o)}),e.appEventBus.on("userJoined",function(t){e.chatroomModel.addUser(t),e.chatroomModel.addChat({sender:"Mayor McCheese",message:t+" joined room."})}),e.appEventBus.on("userLeft",function(t){e.chatroomModel.removeUser(t),e.chatroomModel.addChat({sender:"Grimace",message:t+" left room."})}),e.appEventBus.on("chatReceived",function(t){e.chatroomModel.addChat(t),$(".chatbox-content")[0].scrollTop=$(".chatbox-content")[0].scrollHeight})};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoYXQtbW9kZWxzLmpzIiwibWFpbi5qcyIsInNvY2tldGNsaWVudC5qcyJdLCJuYW1lcyI6WyJDb250YWluZXJNb2RlbCIsIkJhY2tib25lIiwiTW9kZWwiLCJleHRlbmQiLCJVc2VyTW9kZWwiLCJVc2VyQ29sbGVjdGlvbiIsIkNvbGxlY3Rpb24iLCJtb2RlbCIsIkNoYXRNb2RlbCIsIkNoYXRDb2xsZWN0aW9uIiwiQ2hhdHJvb21Nb2RlbCIsImRlZmF1bHRzIiwib25saW5lVXNlcnMiLCJ1c2VyQ2hhdHMiLCJzZW5kZXIiLCJtZXNzYWdlIiwidGltZXN0YW1wIiwiXyIsIm5vdyIsImFkZFVzZXIiLCJ1c2VybmFtZSIsInRoaXMiLCJnZXQiLCJhZGQiLCJjb25zb2xlIiwibG9nIiwicmVtb3ZlVXNlciIsInVzZXIiLCJmaW5kIiwidXNlck1vZGVsIiwicmVtb3ZlIiwiYWRkQ2hhdCIsImNoYXQiLCJMb2dpbk1vZGVsIiwiZXJyb3IiLCJDb250YWluZXJWaWV3IiwiVmlldyIsImVsIiwiaW5pdGlhbGl6ZSIsIm9wdGlvbnMiLCJvbiIsInJlbmRlciIsInZpZXciLCIkZWwiLCJodG1sIiwiTG9naW5WaWV3IiwidGVtcGxhdGUiLCIkIiwiZXZlbnRzIiwiY2xpY2sgI25hbWVCdG4iLCJrZXlwcmVzcyAjbmFtZVRleHQiLCJ2ZW50IiwibGlzdGVuVG8iLCJ0b0pTT04iLCJvbkxvZ2luIiwidHJpZ2dlciIsInZhbCIsIm9uSGl0RW50ZXIiLCJlIiwia2V5Q29kZSIsIkNoYXRyb29tVmlldyIsImtleXByZXNzIC5tZXNzYWdlLWlucHV0IiwicmVuZGVyVXNlciIsInJlbmRlclVzZXJzIiwicmVuZGVyQ2hhdCIsInJlbmRlckNoYXRzIiwiZW1wdHkiLCJlYWNoIiwiYXBwZW5kIiwiZWxlbWVudCIsImFwcGVuZFRvIiwiaGlkZSIsImZhZGVJbiIsInNsaWRlRG93biIsIm1lc3NhZ2VJbnB1dFByZXNzZWQiLCJ0cmltIiwibGVuZ3RoIiwiQ2hhdENsaWVudCIsImxhc3RUeXBpbmdUaW1lIiwic2VsZiIsIlRZUElOR19USU1FUl9MRU5HVEgiLCJ0eXBpbmciLCJob3N0bmFtZSIsIndpbmRvdyIsImxvY2F0aW9uIiwiaG9zdCIsImNvbm5lY3QiLCJzb2NrZXQiLCJpbyIsInNldFJlc3BvbnNlTGlzdGVuZXJzIiwibG9naW4iLCJuYW1lIiwiZW1pdCIsImFkZENoYXRUeXBpbmciLCJkYXRhIiwidGV4dCIsInJlbW92ZUNoYXRUeXBpbmciLCJ1cGRhdGVUeXBpbmciLCJEYXRlIiwiZ2V0VGltZSIsInNldFRpbWVvdXQiLCJ0eXBpbmdUaW1lciIsInRpbWVEaWZmIiwiZG9jdW1lbnQiLCJyZWFkeSIsIm1haW5Db250cm9sbGVyIiwiTWFpbkNvbnRyb2xsZXIiLCJpbml0IiwiYXBwRXZlbnRCdXMiLCJFdmVudHMiLCJ2aWV3RXZlbnRCdXMiLCJjaGF0Q2xpZW50IiwibG9naW5Nb2RlbCIsImNvbnRhaW5lck1vZGVsIiwidmlld1N0YXRlIiwiY29udGFpbmVyVmlldyIsImNoYXRyb29tTW9kZWwiLCJjaGF0cm9vbVZpZXciLCJzZXQiLCJhdXRvc2l6ZSIsInNjcm9sbFRvcCIsInNjcm9sbEhlaWdodCIsInVzZXJzIiwibWFwIiwiaXRlbSIsInJlc2V0Il0sIm1hcHBpbmdzIjoiQUFBQSxHQUFBQSxnQkFBQUMsU0FBQUMsTUFBQUMsV0FFQUMsVUFBQUgsU0FBQUMsTUFBQUMsV0FDQUUsZUFBQUosU0FBQUssV0FBQUgsUUFBQUksTUFBQUgsWUFFQUksVUFBQVAsU0FBQUMsTUFBQUMsV0FDQU0sZUFBQVIsU0FBQUssV0FBQUgsUUFBQUksTUFBQUMsWUFFQUUsY0FBQVQsU0FBQUMsTUFBQUMsUUFDQVEsVUFDQUMsWUFBQSxHQUFBUCxnQkFDQVEsVUFBQSxHQUFBSixpQkFFQSxHQUFBRCxZQUFBTSxPQUFBLFVBQUFDLFFBQUEsNkJBQUFDLFVBQUFDLEVBQUFDLFdBR0FDLFFBQUEsU0FBQUMsR0FDQUMsS0FBQUMsSUFBQSxlQUFBQyxJQUFBLEdBQUFuQixZQUFBZ0IsU0FBQUEsS0FD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R0FDQTJELEVBQUFpQyxXQUFBTSxJQUFBLFFBQUEseUJBS0F2QyxFQUFBNkIsWUFBQXBFLEdBQUEsWUFBQSxTQUFBc0QsR0FNQSxHQUFBbEYsR0FBQW1FLEVBQUFxQyxjQUFBOUYsSUFBQSxlQUdBb0csRUFBQXpHLEVBQUEwRyxJQUFBN0IsRUFBQSxTQUFBOEIsR0FDQSxNQUFBLElBQUF4SCxZQUFBZ0IsU0FBQXdHLEtBSUFoSCxHQUFBaUgsTUFBQUgsS0FJQTNDLEVBQUE2QixZQUFBcEUsR0FBQSxhQUFBLFNBQUFwQixHQUNBMkQsRUFBQXFDLGNBQUFqRyxRQUFBQyxHQUNBMkQsRUFBQXFDLGNBQUFyRixTQUFBakIsT0FBQSxpQkFBQUMsUUFBQUssRUFBQSxvQkFJQTJELEVBQUE2QixZQUFBcEUsR0FBQSxXQUFBLFNBQUFwQixHQUNBMkQsRUFBQXFDLGNBQUExRixXQUFBTixHQUNBMkQsRUFBQXFDLGNBQUFyRixTQUFBakIsT0FBQSxVQUFBQyxRQUFBSyxFQUFBLGtCQUlBMkQsRUFBQTZCLFlBQUFwRSxHQUFBLGVBQUEsU0FBQVIsR0FDQStDLEVBQUFxQyxjQUFBckYsUUFBQUMsR0FDQWUsRUFBQSxvQkFBQSxHQUFBeUUsVUFBQXpFLEVBQUEsb0JBQUEsR0FBQTBFIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgQ29udGFpbmVyTW9kZWwgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoe30pO1xuXG52YXIgVXNlck1vZGVsID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKHt9KTtcbnZhciBVc2VyQ29sbGVjdGlvbiA9IEJhY2tib25lLkNvbGxlY3Rpb24uZXh0ZW5kKHttb2RlbDogVXNlck1vZGVsfSk7XG5cbnZhciBDaGF0TW9kZWwgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoe30pO1xudmFyIENoYXRDb2xsZWN0aW9uID0gQmFja2JvbmUuQ29sbGVjdGlvbi5leHRlbmQoe21vZGVsOiBDaGF0TW9kZWx9KTtcblxudmFyIENoYXRyb29tTW9kZWwgPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoe1xuICBkZWZhdWx0czoge1xuICAgIG9ubGluZVVzZXJzOiBuZXcgVXNlckNvbGxlY3Rpb24oKSxcbiAgICB1c2VyQ2hhdHM6IG5ldyBDaGF0Q29sbGVjdGlvbihbXG4gICAgICAvLyBtZXNzYWdlIGFuZCBzZW5kZXIgdXBvbiBlbnRlcmluZyBjaGF0cm9vbVxuICAgICAgbmV3IENoYXRNb2RlbCh7IHNlbmRlcjogJ0J1dHRlcnMnLCBtZXNzYWdlOiAnYXd3d3d3dyBoYW1idXJnZXJzLiB8fCk6fHwnLCB0aW1lc3RhbXA6IF8ubm93KCkgfSlcbiAgICAgIF0pXG4gIH0sXG4gIGFkZFVzZXI6IGZ1bmN0aW9uKHVzZXJuYW1lKSB7XG4gICAgdGhpcy5nZXQoJ29ubGluZVVzZXJzJykuYWRkKG5ldyBVc2VyTW9kZWwoeyB1c2VybmFtZTogdXNlcm5hbWUgfSkpO1xuICAgIGNvbnNvbGUubG9nKFwiLS1hZGRpbmctdXNlci0tLVwiKTtcbiAgfSxcbiAgcmVtb3ZlVXNlcjogZnVuY3Rpb24odXNlcm5hbWUpIHtcbiAgICB2YXIgb25saW5lVXNlcnMgPSB0aGlzLmdldCgnb25saW5lVXNlcnMnKTtcbiAgICB2YXIgdXNlciA9IG9ubGluZVVzZXJzLmZpbmQoZnVuY3Rpb24odXNlck1vZGVsKSB7IHJldHVybiB1c2VyTW9kZWwuZ2V0KCd1c2VybmFtZScpID09IHVzZXJuYW1lOyB9KTtcbiAgICBpZiAodXNlcikge1xuICAgICAgb25saW5lVXNlcnMucmVtb3ZlKHVzZXIpO1xuICAgIH1cbiAgfSxcbiAgYWRkQ2hhdDogZnVuY3Rpb24oY2hhdCkge1xuICAgIHZhciBub3cgPSBfLm5vdygpO1xuICAgIHRoaXMuZ2V0KCd1c2VyQ2hhdHMnKS5hZGQobmV3IENoYXRNb2RlbCh7IHNlbmRlcjogY2hhdC5zZW5kZXIsIG1lc3NhZ2U6IGNoYXQubWVzc2FnZSwgdGltZXN0YW1wOiBub3d9KSk7XG4gIH0sXG59KTtcblxuXG4vLyBMb2dpbk1vZGVsXG52YXIgTG9naW5Nb2RlbCA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7XG4gIGRlZmF1bHRzOiB7XG4gICAgZXJyb3I6IFwiXCJcbiAgfVxufSk7XG5cblxuXG4vLyB2YXIgVXNlciA9IEJhY2tib25lLk1vZGVsLmV4dGVuZCh7XG4vLyBcdGRlZmF1bHRzOiB7XG4vLyBcdFx0dXNlcm5hbWU6ICcnLFxuLy8gXHRcdGF2YXRhcjogJycsXG4vLyBcdFx0aW5ib3g6IFtdLFxuLy8gXHR9LFxuLy8gfSk7XG5cbi8vIHZhciBDb252ZXJzYXRpb24gPSBCYWNrYm9uZS5Nb2RlbC5leHRlbmQoe1xuLy8gXHRkZWZhdWx0czoge1xuLy8gXHRcdHVzZXJzOiBbXSxcbi8vIFx0XHRtZXNzYWdlczogW10sXG4vLyBcdH0sXG4vLyB9KTsiLCJcbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuICB2YXIgbWFpbkNvbnRyb2xsZXIgPSBuZXcgTWFpbkNvbnRyb2xsZXIoKTtcbiAgbWFpbkNvbnRyb2xsZXIuaW5pdCgpO1xufSk7XG5cblxudmFyIE1haW5Db250cm9sbGVyID0gZnVuY3Rpb24oKSB7XG5cblx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cbiAgLy9UaGVzZSBhbGxvd3MgdXMgdG8gYmluZCBhbmQgdHJpZ2dlciBvbiB0aGUgb2JqZWN0IGZyb20gYW55d2hlcmUgaW4gdGhlIGFwcC5cblx0c2VsZi5hcHBFdmVudEJ1cyA9IF8uZXh0ZW5kKHt9LCBCYWNrYm9uZS5FdmVudHMpO1xuXHRzZWxmLnZpZXdFdmVudEJ1cyA9IF8uZXh0ZW5kKHt9LCBCYWNrYm9uZS5FdmVudHMpO1xuXG5cdHNlbGYuaW5pdCA9IGZ1bmN0aW9uKCkge1xuXHRcdC8vIGNyZWF0ZXMgQ2hhdENsaWVudCBmcm9tIHNvY2tldGNsaWVudC5qcywgcGFzc2VzIGluIFxuXHRcdC8vIGFwcEV2ZW50QnVzIGFzIHZlbnQsIGNvbm5lY3RzXG5cdFx0c2VsZi5jaGF0Q2xpZW50ID0gbmV3IENoYXRDbGllbnQoeyB2ZW50OiBzZWxmLmFwcEV2ZW50QnVzIH0pO1xuXHRcdHNlbGYuY2hhdENsaWVudC5jb25uZWN0KCk7XG5cbiAgICAvLyBsb2dpbk1vZGVsXG5cdFx0c2VsZi5sb2dpbk1vZGVsID0gbmV3IExvZ2luTW9kZWwoKTtcblxuICAgIC8vIFRoZSBDb250YWluZXJNb2RlbCBnZXRzIHBhc3NlZCBhIHZpZXdTdGF0ZSwgTG9naW5WaWV3LCB3aGljaFxuICAgIC8vIGlzIHRoZSBsb2dpbiBwYWdlLiBUaGF0IExvZ2luVmlldyBnZXRzIHBhc3NlZCB0aGUgdmlld0V2ZW50QnVzXG4gICAgLy8gYW5kIHRoZSBMb2dpbk1vZGVsLlxuXHRcdHNlbGYuY29udGFpbmVyTW9kZWwgPSBuZXcgQ29udGFpbmVyTW9kZWwoeyB2aWV3U3RhdGU6IG5ldyBMb2dpblZpZXcoe3ZlbnQ6IHNlbGYudmlld0V2ZW50QnVzLCBtb2RlbDogc2VsZi5sb2dpbk1vZGVsfSl9KTtcblxuXHRcdC8vIG5leHQsIGEgbmV3IENvbnRhaW5lclZpZXcgaXMgaW50aWFsaXplZCB3aXRoIHRoZSBuZXdseSBjcmVhdGVkIGNvbnRhaW5lck1vZGVsXG5cdFx0Ly8gdGhlIGxvZ2luIHBhZ2UgaXMgdGhlbiByZW5kZXJlZC5cblx0XHRzZWxmLmNvbnRhaW5lclZpZXcgPSBuZXcgQ29udGFpbmVyVmlldyh7IG1vZGVsOiBzZWxmLmNvbnRhaW5lck1vZGVsIH0pO1xuXHRcdHNlbGYuY29udGFpbmVyVmlldy5yZW5kZXIoKTtcblx0fTtcblxuXG5cbiAgLy8vLy8vLy8vLy8vICBCdXNzZXMgLy8vLy8vLy8vLy8vXG4gICAgLy8gVGhlc2UgQnVzc2VzIGxpc3RlbiB0byB0aGUgc29ja2V0Y2xpZW50XG4gICAvLyAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuXG4gIC8vLy8gdmlld0V2ZW50QnVzIExpc3RlbmVycyAvLy8vL1xuICBcblx0c2VsZi52aWV3RXZlbnRCdXMub24oXCJsb2dpblwiLCBmdW5jdGlvbih1c2VybmFtZSkge1xuICAgIC8vIHNvY2tldGlvIGxvZ2luLCBzZW5kcyBuYW1lIHRvIHNvY2tldGNsaWVudCwgc29ja2V0Y2xpZW50IHNlbmRzIGl0IHRvIGNoYXRzZXJ2ZXJcbiAgICBzZWxmLmNoYXRDbGllbnQubG9naW4odXNlcm5hbWUpO1xuICB9KTtcblx0c2VsZi52aWV3RXZlbnRCdXMub24oXCJjaGF0XCIsIGZ1bmN0aW9uKGNoYXQpIHtcbiAgICAvLyBzb2NrZXRpbyBjaGF0LCBzZW5kcyBjaGF0IHRvIHNvY2tldGNsaWVudCwgc29ja2V0Y2xpZW50IHRvIGNoYXRzZXJ2ZXJcbiAgICBzZWxmLmNoYXRDbGllbnQuY2hhdChjaGF0KTtcbiAgfSk7XG4gIHNlbGYudmlld0V2ZW50QnVzLm9uKFwidHlwaW5nXCIsIGZ1bmN0aW9uKCkge1xuICAgIHNlbGYuY2hhdENsaWVudC51cGRhdGVUeXBpbmcoKTtcbiAgfSk7XG5cblxuICAvLy8vIGFwcEV2ZW50QnVzIExpc3RlbmVycyAvLy8vXG5cbiAgLy8gYWZ0ZXIgdGhlICd3ZWxjb21lJyBldmVudCB0cmlnZ2VycyBvbiB0aGUgc29ja2VjbGllbnQsIHRoZSBsb2dpbkRvbmUgZXZlbnQgdHJpZ2dlcnMuXG5cdHNlbGYuYXBwRXZlbnRCdXMub24oXCJsb2dpbkRvbmVcIiwgZnVuY3Rpb24oKSB7XG5cblx0XHQvLyBuZXcgbW9kZWwgYW5kIHZpZXcgY3JlYXRlZCBmb3IgY2hhdHJvb21cblx0XHRzZWxmLmNoYXRyb29tTW9kZWwgPSBuZXcgQ2hhdHJvb21Nb2RlbCgpO1xuXHRcdHNlbGYuY2hhdHJvb21WaWV3ICA9IG5ldyBDaGF0cm9vbVZpZXcoe3ZlbnQ6IHNlbGYudmlld0V2ZW50QnVzLCBtb2RlbDogc2VsZi5jaGF0cm9vbU1vZGVsIH0pO1xuXG5cdFx0Ly8gdmlld3N0YXRlIGlzIGNoYW5nZWQgdG8gY2hhdHJvb20gYWZ0ZXIgbG9naW4uXG5cdFx0c2VsZi5jb250YWluZXJNb2RlbC5zZXQoXCJ2aWV3U3RhdGVcIiwgc2VsZi5jaGF0cm9vbVZpZXcpO1xuICAgIGF1dG9zaXplKCQoJ3RleHRhcmVhLm1lc3NhZ2UtaW5wdXQnKSk7XG5cdFx0JCgnLmNoYXRib3gtY29udGVudCcpWzBdLnNjcm9sbFRvcCA9ICQoJy5jaGF0Ym94LWNvbnRlbnQnKVswXS5zY3JvbGxIZWlnaHQ7XG5cdH0pO1xuXG4gIC8vIGVycm9yIGxpc3RlbmVyc1xuXHRzZWxmLmFwcEV2ZW50QnVzLm9uKFwibG9naW5OYW1lQmFkXCIsIGZ1bmN0aW9uKHVzZXJuYW1lKSB7XG5cdFx0c2VsZi5sb2dpbk1vZGVsLnNldChcImVycm9yXCIsIFwiSW52YWxpZCBOYW1lXCIpO1xuXHR9KTtcblx0c2VsZi5hcHBFdmVudEJ1cy5vbihcImxvZ2luTmFtZUV4aXN0c1wiLCBmdW5jdGlvbih1c2VybmFtZSkge1xuXHRcdHNlbGYubG9naW5Nb2RlbC5zZXQoXCJlcnJvclwiLCBcIk5hbWUgYWxyZWFkeSBleGlzdHNcIik7XG5cdH0pO1xuXG5cbiAgLy8gYWZ0ZXIgJ29ubGluZVVzZXJzJyBldmVudCBlbWl0cywgdGhlICd1c2Vyc0luZm8nIGV2ZW50IHRyaWdnZXJzXG5cdHNlbGYuYXBwRXZlbnRCdXMub24oXCJ1c2Vyc0luZm9cIiwgZnVuY3Rpb24oZGF0YSkge1xuXG4gICAgLy9kYXRhIGlzIGFuIGFycmF5IG9mIHVzZXJuYW1lcywgaW5jbHVkaW5nIHRoZSBuZXcgdXNlclxuXG5cdFx0Ly8gVGhpcyBtZXRob2QgZ2V0cyB0aGUgb25saW5lIHVzZXJzIGNvbGxlY3Rpb24gZnJvbSBjaGF0cm9vbU1vZGVsLlxuXHRcdC8vIG9ubGluZVVzZXJzIGlzIHRoZSBjb2xsZWN0aW9uXG5cdFx0dmFyIG9ubGluZVVzZXJzID0gc2VsZi5jaGF0cm9vbU1vZGVsLmdldChcIm9ubGluZVVzZXJzXCIpO1xuXG4gICAvLyB1c2VycyBpcyBhcnJheSBvZiB0aGUgY3VycmVudCB1c2VyIG1vZGVsc1xuXHRcdHZhciB1c2VycyA9IF8ubWFwKGRhdGEsIGZ1bmN0aW9uKGl0ZW0pIHtcblx0XHRcdHJldHVybiBuZXcgVXNlck1vZGVsKHt1c2VybmFtZTogaXRlbX0pO1xuXHRcdH0pO1xuXG4gICAgLy8gdGhpcyByZXNldHMgdGhlIGNvbGxlY3Rpb24gd2l0aCB0aGUgdXBkYXRlZCBhcnJheSBvZiB1c2Vyc1xuXHRcdG9ubGluZVVzZXJzLnJlc2V0KHVzZXJzKTtcblx0fSk7XG5cbiAgLy8gYWRkcyBuZXcgdXNlciB0byB1c2VycyBjb2xsZWN0aW9uLCBzZW5kcyBkZWZhdWx0IGpvaW5pbmcgbWVzc2FnZVxuXHRzZWxmLmFwcEV2ZW50QnVzLm9uKFwidXNlckpvaW5lZFwiLCBmdW5jdGlvbih1c2VybmFtZSkge1xuXHRcdHNlbGYuY2hhdHJvb21Nb2RlbC5hZGRVc2VyKHVzZXJuYW1lKTtcblx0XHRzZWxmLmNoYXRyb29tTW9kZWwuYWRkQ2hhdCh7c2VuZGVyOiBcIk1heW9yIE1jQ2hlZXNlXCIsIG1lc3NhZ2U6IHVzZXJuYW1lICsgXCIgam9pbmVkIHJvb20uXCIgfSk7XG5cdH0pO1xuXG5cdC8vIHJlbW92ZXMgdXNlciBmcm9tIHVzZXJzIGNvbGxlY3Rpb24sIHNlbmRzIGRlZmF1bHQgbGVhdmluZyBtZXNzYWdlXG5cdHNlbGYuYXBwRXZlbnRCdXMub24oXCJ1c2VyTGVmdFwiLCBmdW5jdGlvbih1c2VybmFtZSkge1xuXHRcdHNlbGYuY2hhdHJvb21Nb2RlbC5yZW1vdmVVc2VyKHVzZXJuYW1lKTtcblx0XHRzZWxmLmNoYXRyb29tTW9kZWwuYWRkQ2hhdCh7c2VuZGVyOiBcIkdyaW1hY2VcIiwgbWVzc2FnZTogdXNlcm5hbWUgKyBcIiBsZWZ0IHJvb20uXCIgfSk7XG5cdH0pO1xuXG5cdC8vIGNoYXQgcGFzc2VkIGZyb20gc29ja2V0Y2xpZW50LCBhZGRzIGEgbmV3IGNoYXQgbWVzc2FnZSB1c2luZyBjaGF0cm9vbU1vZGVsIG1ldGhvZFxuXHRzZWxmLmFwcEV2ZW50QnVzLm9uKFwiY2hhdFJlY2VpdmVkXCIsIGZ1bmN0aW9uKGNoYXQpIHtcblx0XHRzZWxmLmNoYXRyb29tTW9kZWwuYWRkQ2hhdChjaGF0KTtcblx0XHQkKCcuY2hhdGJveC1jb250ZW50JylbMF0uc2Nyb2xsVG9wID0gJCgnLmNoYXRib3gtY29udGVudCcpWzBdLnNjcm9sbEhlaWdodDtcblx0fSk7XG59O1xuXG5cblxuXG5cblxuLy8gdmFyIHRob21Kb25lcyA9XG4vLyBcdFx0e1xuLy8gXHRcdFx0bmFtZTogJ1Rob20gSm9uZXMnLFxuLy8gXHRcdFx0YXZhdGFyOiAnYXNzZXRzL2ltZy90aG9tLWpvbmVzLmpwZycsXG4vLyBcdFx0XHRpZDogMVxuLy8gXHRcdH07XG4vLyB2YXIgdG9tSm9uZXMgPSBcbi8vIFx0XHR7XG4vLyBcdFx0XHRuYW1lOiAnVG9tIEpvbmVzJyxcbi8vIFx0XHRcdGF2YXRhcjogJ2Fzc2V0cy9pbWcvdG9tLWpvbmVzLmpwZycsXG4vLyBcdFx0XHRpZDogMlxuLy8gXHRcdH07XG4vLyB2YXIgZXYgPSBcbi8vIFx0XHR7XG4vLyBcdFx0XHRuYW1lOiAnRXZhbiBUdXJuZXInLFxuLy8gXHRcdFx0YXZhdGFyOiAnaHR0cDovL2V2dHVybi5jb20vYXNzZXRzL2ltZy9ldi13aW50ZXIteWVsbG93LmpwZycsXG4vLyBcdFx0XHRpZDogM1xuLy8gXHRcdH07XG5cbi8vIHZhciBjb252bzEgPSBuZXcgQ29udmVyc2F0aW9uKHtcdFx0XHRcdFxuLy8gXHRcdFx0XHRcdHVzZXJzOiBbdG9tSm9uZXMsIHRob21Kb25lc10sXG4vLyBcdFx0XHRcdFx0bWVzc2FnZXM6XHRbXG4vLyBcdFx0XHRcdFx0XHRcdHtcbi8vIFx0XHRcdFx0XHRcdFx0XHR0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4vLyBcdFx0XHRcdFx0XHRcdFx0Y29udGVudDogJ0NyYWlnLCBpdFxcJ3MgaW1wb3J0YW50LiBJIGp1c3Qgc3BpbGxlZCBzYWxzYSBhbGwgb3ZlciBteSBmaWxhcy4nLFxuLy8gXHRcdFx0XHRcdFx0XHRcdHNlbmRlcjogdG9tSm9uZXNcbi8vIFx0XHRcdFx0XHRcdFx0fSxcbi8vIFx0XHRcdFx0XHRcdFx0e1xuLy8gXHRcdFx0XHRcdFx0XHRcdHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbi8vIFx0XHRcdFx0XHRcdFx0XHRjb250ZW50OiAnSVxcbSBub3QgQ3JhaWchJyxcbi8vIFx0XHRcdFx0XHRcdFx0XHRzZW5kZXI6IHRob21Kb25lc1xuLy8gXHRcdFx0XHRcdFx0XHR9LFxuLy8gXHRcdFx0XHRcdFx0XHR7XG4vLyBcdFx0XHRcdFx0XHRcdFx0dGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuLy8gXHRcdFx0XHRcdFx0XHRcdGNvbnRlbnQ6ICdGdWNrIHRoZSBoZWxsIG9mZiEnLFxuLy8gXHRcdFx0XHRcdFx0XHRcdHNlbmRlcjogdGhvbUpvbmVzXG4vLyBcdFx0XHRcdFx0XHRcdH1cbi8vIFx0XHRcdFx0XHRcdF1cbi8vIFx0XHRcdFx0XHR9KTtcbi8vIHZhciBjb252bzIgPSBuZXcgQ29udmVyc2F0aW9uKHtcbi8vIFx0XHRcdFx0dXNlcnM6IFt0b21Kb25lcywgdGhvbUpvbmVzXSxcdFx0XHRcbi8vIFx0XHRcdFx0bWVzc2FnZXM6XHRbXG4vLyBcdFx0XHRcdFx0XHR7XG4vLyBcdFx0XHRcdFx0XHRcdHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbi8vIFx0XHRcdFx0XHRcdFx0Y29udGVudDogJ0NyYWlnLCBpdFxcJ3MgaW1wb3J0YW50LiBJIGp1c3Qgc3BpbGxlZCBzYWxzYSBhbGwgb3ZlciBteSBmaWxhcy4nLFxuLy8gXHRcdFx0XHRcdFx0XHRzZW5kZXI6IHRvbUpvbmVzXG4vLyBcdFx0XHRcdFx0XHR9LFxuLy8gXHRcdFx0XHRcdFx0e1xuLy8gXHRcdFx0XHRcdFx0XHR0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4vLyBcdFx0XHRcdFx0XHRcdGNvbnRlbnQ6ICdJXFxtIG5vdCBDcmFpZyEnLFxuLy8gXHRcdFx0XHRcdFx0XHRzZW5kZXI6IHRob21Kb25lc1xuLy8gXHRcdFx0XHRcdFx0fSxcbi8vIFx0XHRcdFx0XHRcdHtcbi8vIFx0XHRcdFx0XHRcdFx0dGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuLy8gXHRcdFx0XHRcdFx0XHRjb250ZW50OiAnSnVzdCBhdGUgYSBiaXNxdWl0Jyxcbi8vIFx0XHRcdFx0XHRcdFx0c2VuZGVyOiB0b21Kb25lc1xuLy8gXHRcdFx0XHRcdFx0fVxuLy8gXHRcdFx0XHRcdF1cbi8vIFx0XHRcdFx0fSk7XG4vLyB2YXIgY29udm8zID0gbmV3IENvbnZlcnNhdGlvbih7XG4vLyBcdFx0XHRcdHVzZXJzOiBbZXYsIHRob21Kb25lc10sXG4vLyBcdFx0XHRcdG1lc3NhZ2VzOlx0W1xuLy8gXHRcdFx0XHRcdFx0e1xuLy8gXHRcdFx0XHRcdFx0XHR0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4vLyBcdFx0XHRcdFx0XHRcdGNvbnRlbnQ6ICdDcmFpZywgaXRcXCdzIGltcG9ydGFudC4gSSBqdXN0IHNwaWxsZWQgc2Fsc2EgYWxsIG92ZXIgbXkgZmlsYXMuJyxcbi8vIFx0XHRcdFx0XHRcdFx0c2VuZGVyOiB0b21Kb25lc1xuLy8gXHRcdFx0XHRcdFx0fSxcbi8vIFx0XHRcdFx0XHRcdHtcbi8vIFx0XHRcdFx0XHRcdFx0dGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuLy8gXHRcdFx0XHRcdFx0XHRjb250ZW50OiAnSVxcbSBub3QgQ3JhaWchJyxcbi8vIFx0XHRcdFx0XHRcdFx0c2VuZGVyOiB0aG9tSm9uZXNcbi8vIFx0XHRcdFx0XHRcdH0sXG4vLyBcdFx0XHRcdFx0XHR7XG4vLyBcdFx0XHRcdFx0XHRcdHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbi8vIFx0XHRcdFx0XHRcdFx0Y29udGVudDogJ1BsZWFzZSBsZWF2ZSBteSB3aWZlIGluIHRoaXMnLFxuLy8gXHRcdFx0XHRcdFx0XHRzZW5kZXI6IGV2XG4vLyBcdFx0XHRcdFx0XHR9XG4vLyBcdFx0XHRcdFx0XX0pO1xuXG4vLyB2YXIgdTIgPSBuZXcgVXNlcih0aG9tSm9uZXMpO1xuXG4vLyB2YXIgdTEgPSBuZXcgVXNlcih7XG4vLyBcdFx0XHRuYW1lOiAnVG9tIEpvbmVzJyxcbi8vIFx0XHRcdGF2YXRhcjogJ2h0dHA6Ly9hNS5maWxlcy5iaW9ncmFwaHkuY29tL2ltYWdlL3VwbG9hZC9jX2ZpbGwsY3Nfc3JnYixkcHJfMS4wLGdfZmFjZSxoXzMwMCxxXzgwLHdfMzAwL01URTFPREEwT1RjeU1EQTFOamc0T0RRMS5qcGcnLFxuLy8gXHRcdFx0aW5ib3g6IFxuLy8gXHRcdFx0XHRbXG4vLyBcdFx0XHRcdFx0Y29udm8xLFxuLy8gXHRcdFx0XHRcdGNvbnZvMixcbi8vIFx0XHRcdFx0XHRjb252bzNcbi8vIFx0XHRcdFx0XSxcdFxuLy8gXHRcdFx0aWQ6IDFcbi8vIFx0XHR9KTtcblxuXG4vLyBuZXcgV09XKFxuLy8gICAgIHsgb2Zmc2V0OiAxMjAgfVxuLy8gKS5pbml0KCk7XG5cblxuLy8gbmV3IENoYXRib3goKTtcbiIsIlxuLy8gVGhlIENoYXRDbGllbnQgaXMgaW1wbGVtZW50ZWQgb24gbWFpbi5qcy5cbi8vIFRoZSBjaGF0Y2xpZW50IGlzIGEgY29uc3RydWN0b3IgZnVuY3Rpb24gb24gdGhlIE1haW5Db250cm9sbGVyLlxuLy8gSXQgYm90aCBsaXN0ZW5zIHRvIGFuZCBlbWl0cyBldmVudHMgb24gdGhlIHNvY2tldCwgZWc6XG4vLyBJdCBoYXMgaXRzIG93biBtZXRob2RzIHRoYXQsIHdoZW4gY2FsbGVkLCBlbWl0IHRvIHRoZSBzb2NrZXQgdy8gZGF0YS5cbi8vIEl0IGFsc28gc2V0cyByZXNwb25zZSBsaXN0ZW5lcnMgb24gY29ubmVjdGlvbiwgdGhlc2UgcmVzcG9uc2UgbGlzdGVuZXJzXG4vLyBsaXN0ZW4gdG8gdGhlIHNvY2tldCBhbmQgdHJpZ2dlciBldmVudHMgb24gdGhlIGFwcEV2ZW50QnVzIG9uIHRoZSBcbi8vIE1haW5Db250cm9sbGVyXG52YXIgQ2hhdENsaWVudCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcblxuXHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0Ly8gaXMtdHlwaW5nIGhlbHBlciB2YXJpYWJsZXNcblx0dmFyIFRZUElOR19USU1FUl9MRU5HVEggPSA0MDA7IC8vIG1zXG4gIHZhciB0eXBpbmcgPSBmYWxzZTtcbiAgdmFyIGxhc3RUeXBpbmdUaW1lO1xuICBcbiAgLy8gdGhpcyB2ZW50IGhvbGRzIHRoZSBhcHBFdmVudEJ1c1xuXHRzZWxmLnZlbnQgPSBvcHRpb25zLnZlbnQ7XG5cblx0c2VsZi5ob3N0bmFtZSA9ICdodHRwOi8vJyArIHdpbmRvdy5sb2NhdGlvbi5ob3N0O1xuXG4gIC8vIGNvbm5lY3RzIHRvIHNvY2tldCwgc2V0cyByZXNwb25zZSBsaXN0ZW5lcnNcblx0c2VsZi5jb25uZWN0ID0gZnVuY3Rpb24oKSB7XG5cdFx0Ly8gdGhpcyBpbyBtaWdodCBiZSBhIGxpdHRsZSBjb25mdXNpbmcuLi4gd2hlcmUgaXMgaXQgY29taW5nIGZyb20/XG5cdFx0Ly8gaXQncyBjb21pbmcgZnJvbSB0aGUgc3RhdGljIG1pZGRsZXdhcmUgb24gc2VydmVyLmpzIGJjIGV2ZXJ5dGhpbmdcblx0XHQvLyBpbiB0aGUgL3B1YmxpYyBmb2xkZXIgaGFzIGJlZW4gYXR0YWNoZWQgdG8gdGhlIHNlcnZlciwgYW5kIHZpc2Fcblx0XHQvLyB2ZXJzYS5cblx0XHRzZWxmLnNvY2tldCA9IGlvLmNvbm5lY3Qoc2VsZi5ob3N0bmFtZSk7XG5cdFx0c2VsZi5zZXRSZXNwb25zZUxpc3RlbmVycyhzZWxmLnNvY2tldCk7XG5cdH07XG5cbiAgICAvLy8vLyBWaWV3RXZlbnRCdXMgbWV0aG9kcyAvLy8vXG4gICAgLy8gbWV0aG9kcyB0aGF0IGVtaXQgdG8gdGhlIGNoYXRzZXJ2ZXJcblx0XHQvLyBlbWl0cyBsb2dpbiBldmVudCB0byBjaGF0c2VydmVyXG5cdHNlbGYubG9naW4gPSBmdW5jdGlvbihuYW1lKSB7XG5cdFx0c2VsZi5zb2NrZXQuZW1pdChcImxvZ2luXCIsIG5hbWUpO1xuXHR9O1xuICAgIC8vIGVtaXRzIGNoYXQgZXZlbnQgdG8gY2hhdHNlcnZlclxuXHRzZWxmLmNoYXQgPSBmdW5jdGlvbihjaGF0KSB7XG5cdFx0c2VsZi5zb2NrZXQuZW1pdChcImNoYXRcIiwgY2hhdCk7XG5cdH07XG5cblxuICAvLyBUeXBpbmcgbWV0aG9kc1xuXHRzZWxmLmFkZENoYXRUeXBpbmcgPSBmdW5jdGlvbihkYXRhKSB7XG4gICAgdmFyIG1lc3NhZ2UgPSBkYXRhLnVzZXJuYW1lICsgJyBpcyB0eXBpbmcnO1xuICAgICQoJy50eXBldHlwZXR5cGUnKS50ZXh0KG1lc3NhZ2UpO1xuXHR9O1xuXG5cdHNlbGYucmVtb3ZlQ2hhdFR5cGluZyA9IGZ1bmN0aW9uKCkge1xuICAgICQoJy50eXBldHlwZXR5cGUnKS5lbXB0eSgpO1xuXHR9O1xuXG4gIHNlbGYudXBkYXRlVHlwaW5nID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHNlbGYuc29ja2V0KSB7XG4gICAgICBpZiAoIXR5cGluZykge1xuICAgICAgICB0eXBpbmcgPSB0cnVlO1xuICAgICAgICBzZWxmLnNvY2tldC5lbWl0KCd0eXBpbmcnKTtcbiAgICAgIH1cbiAgICAgIGxhc3RUeXBpbmdUaW1lID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKTtcblxuICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHR5cGluZ1RpbWVyID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKTtcbiAgICAgICAgdmFyIHRpbWVEaWZmID0gdHlwaW5nVGltZXIgLSBsYXN0VHlwaW5nVGltZTtcbiAgICAgICAgaWYgKHRpbWVEaWZmID49IFRZUElOR19USU1FUl9MRU5HVEggJiYgdHlwaW5nKSB7XG4gICAgICAgICAgIHNlbGYuc29ja2V0LmVtaXQoJ3N0b3AgdHlwaW5nJyk7XG4gICAgICAgICAgIHR5cGluZyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9LCBUWVBJTkdfVElNRVJfTEVOR1RIKTtcbiAgICB9XG4gIH07XG5cblxuXG4gIC8vIGNoYXRzZXJ2ZXIgbGlzdGVuZXJzXG4gIC8vIHRoZXNlIGd1eXMgbGlzdGVuIHRvIHRoZSBjaGF0c2VydmVyL3NvY2tldCBhbmQgZW1pdCBkYXRhIHRvIG1haW4uanMsXG4gIC8vIHNwZWNpZmljYWxseSB0byB0aGUgYXBwRXZlbnRCdXMuXG5cdHNlbGYuc2V0UmVzcG9uc2VMaXN0ZW5lcnMgPSBmdW5jdGlvbihzb2NrZXQpIHtcblx0XHQvLyBjbGllbnQgbGlzdGVuZXJzIHRoYXQgbGlzdGVuIHRvIHRoZSBjaGF0c2VydmVyIGFuZCBpdHNlbGYuXG5cdFx0Ly8gRWFjaCBzZXJ2ZXIgZXZlbnQgdHJpZ2dlcnMgYW4gYXBwRXZlbnRCdXMgZXZlbnQgcGFpcmVkIHdpdGggXG5cdFx0Ly8gcmVsZXZhbnQgZGF0YS5cblxuXHRcdHNvY2tldC5vbignd2VsY29tZScsIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgIC8vIGVtaXRzIGV2ZW50IHRvIHJlY2FsaWJyYXRlIG9ubGluZVVzZXJzIGNvbGxlY3Rpb25cbiAgICAgIHNvY2tldC5lbWl0KFwib25saW5lVXNlcnNcIik7XG5cdFx0XHRjb25zb2xlLmxvZygnb25saW5lVXNlcnMxOiAnLCBkYXRhKTtcbiAgICAgIC8vIGRhdGEgaXMgdW5kZWZpbmVkIGF0IHRoaXMgcG9pbnQgYmVjYXVzZSBpdCdzIHRoZSBmaXJzdCB0b1xuICAgICAgLy8gZmlyZSBvZmYgYW4gZXZlbnQgY2hhaW4gdGhhdCB3aWxsIGFwcGVuZCB0aGUgbmV3IHVzZXIgdG8gXG4gICAgICAvLyB0aGUgb25saW5lVXNlciBjb2xsZWN0aW9uXG4gICAgICBzZWxmLnZlbnQudHJpZ2dlcihcImxvZ2luRG9uZVwiLCBkYXRhKTtcbiAgICB9KTtcblxuXHRcdHNvY2tldC5vbignbG9naW5OYW1lRXhpc3RzJywgZnVuY3Rpb24oZGF0YSkge1xuICAgICAgLy8gZGF0YSA9PT0gc3RyaW5nIG9mIHVzZWQgdXNlcm5hbWVcblx0XHRcdGNvbnNvbGUubG9nKCdsb2dpbk5hbWVFeGlzdHM6ICcsIGRhdGEpO1xuXHRcdFx0c2VsZi52ZW50LnRyaWdnZXIoXCJsb2dpbk5hbWVFeGlzdHNcIiwgZGF0YSk7XG5cdFx0fSk7XG5cdFx0c29ja2V0Lm9uKCdsb2dpbk5hbWVCYWQnLCBmdW5jdGlvbihkYXRhKSB7XG5cdFx0XHQvLyBkYXRhID09PSBzdHJpbmcgb2YgYmFkIHVzZXJuYW1lXG5cdFx0XHRjb25zb2xlLmxvZygnbG9naW5OYW1lQmFkOiAnLCBkYXRhKTtcblx0XHRcdHNlbGYudmVudC50cmlnZ2VyKFwibG9naW5OYW1lQmFkXCIsIGRhdGEpO1xuXHRcdH0pO1xuXG5cdFx0Ly8gdGhpcyBpcyB0aGUgc2Vjb25kIGxpc3RlbmVyIHRvIG9ubGluZVVzZXJzXG5cdFx0Ly8gYnkgdGhlIHRpbWUgdGhpcyBpcyBjYWxsZWQsIHRoZSBuZXcgdXNlciBoYXMgYmVlbiBhZGRlZCB0b1xuXHRcdC8vIHRoZSB1c2VyIGNvbGxlY3Rpb24uXG5cdFx0c29ja2V0Lm9uKCdvbmxpbmVVc2VycycsIGZ1bmN0aW9uKGRhdGEpIHtcblx0XHRcdC8vIHRoaXMgZGF0YSBpcyBhbiBhcnJheSB3aXRoIGFsbCB0aGUgb25saW5lIHVzZXIncyB1c2VybmFtZXMuXG5cdFx0XHRzZWxmLnZlbnQudHJpZ2dlcihcInVzZXJzSW5mb1wiLCBkYXRhKTtcblx0XHR9KTtcblxuXHRcdHNvY2tldC5vbigndXNlckpvaW5lZCcsIGZ1bmN0aW9uKGRhdGEpIHtcblx0XHRcdC8vIGRhdGEgPT09IHVzZXJuYW1lIG9mIHVzZXIgam9pbmVkXG5cdFx0XHRjb25zb2xlLmxvZygndXNlckpvaW5lZDogJywgZGF0YSk7XG5cdFx0XHRzZWxmLnZlbnQudHJpZ2dlcihcInVzZXJKb2luZWRcIiwgZGF0YSk7XG5cdFx0fSk7XG5cdFx0c29ja2V0Lm9uKCd1c2VyTGVmdCcsIGZ1bmN0aW9uKGRhdGEpIHtcblx0XHRcdC8vIGRhdGEgPT09IHVzZXJuYW1lIG9mIHVzZXIgcmVtb3ZlZFxuXHRcdFx0Y29uc29sZS5sb2coJ3VzZXJMZWZ0OiAnLCBkYXRhKTtcblx0XHRcdHNlbGYudmVudC50cmlnZ2VyKFwidXNlckxlZnRcIiwgZGF0YSk7XG5cdFx0fSk7XG5cdFx0c29ja2V0Lm9uKCdjaGF0JywgZnVuY3Rpb24oZGF0YSkge1xuXHRcdFx0Ly8gZGF0YSA9PT0gY2hhdCBtZXNzYWdlIG9iamVjdFxuXHRcdFx0Y29uc29sZS5sb2coJ2NoYXQ6ICcsIGRhdGEpO1xuXHRcdFx0c2VsZi52ZW50LnRyaWdnZXIoXCJjaGF0UmVjZWl2ZWRcIiwgZGF0YSk7XG5cdFx0fSk7XG5cblxuICAgIC8vIHRoZXNlIGd1eXMgbGlzdGVuIHRvIHRoZSBzZXJ2ZXIsIFxuICAgIC8vIHRoZW4gY2FsbCBjaGF0Y2xpZW50IG1ldGhvZHMgbGlzdGVkIGFib3ZlXG4gICAgc29ja2V0Lm9uKCd0eXBpbmcnLCBmdW5jdGlvbihkYXRhKSB7XG4gICAgICBzZWxmLmFkZENoYXRUeXBpbmcoZGF0YSk7XG4gICAgfSk7XG4gICAgc29ja2V0Lm9uKCdzdG9wIHR5cGluZycsIGZ1bmN0aW9uKCkge1xuICAgICAgc2VsZi5yZW1vdmVDaGF0VHlwaW5nKCk7XG4gICAgfSk7XG5cblxuXG5cblxuXHR9O1xufTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=